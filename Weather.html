<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Cloud Function Example</title>
</head>
<body>

    <h1>Google Cloud Function Test updatev0.1</h1>

    <button onclick="callCloudFunction()">Run Cloud Function v2</button>

    <div id="output"></div>

    <script>
            using Google.Cloud.Functions.Framework;
            using Google.Cloud.Functions.Hosting;
            using Microsoft.AspNetCore.Hosting;
            using Microsoft.AspNetCore.Http;
            using Microsoft.Extensions.DependencyInjection;
            using System.Net.Http;
            using System.Threading.Tasks;
            
            namespace SendHttpRequest;

            public class Startup : FunctionsStartup
            {
                public override void ConfigureServices(WebHostBuilderContext context, IServiceCollection services)
                {
                    // Make an HttpClient available to our function via dependency injection.
                    // There are many options here; see
                    // https://docs.microsoft.com/en-us/aspnet/core/fundamentals/http-requests
                    // for more details.
                    services.AddHttpClient<IHttpFunction, Function>();
                }
            }
            
            // Function, decorated with the FunctionsStartup attribute to specify the startup class
            // for dependency injection.
            [FunctionsStartup(typeof(Startup))]
            public class callCloudFunction : IHttpFunction
            {
                private readonly HttpClient _httpClient;
            
                public Function(HttpClient httpClient) =>
                    _httpClient = httpClient;
            
                public async Task HandleAsync(HttpContext context)
                {
                    string url = "http://example.com";
                    using (HttpResponseMessage clientResponse = await _httpClient.GetAsync(url))
                    {
                        await context.Response.WriteAsync($"Received code '{(int) clientResponse.StatusCode}' from URL '{url}'.");
                    }
                }
            }
    </script>

</body>
</html>
