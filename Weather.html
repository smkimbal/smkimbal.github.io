<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Cloud Function test</title>
</head>
<body>

    <h1>Google Cloud Function Test update v0.11</h1>

    <label for="locationInput">Enter locations (comma-separated):</label>
    <input type="text" id="locationInput" placeholder="e.g., kgsb, lciz, klax">
    <button onclick="callCloudFunction()">Run Cloud Function</button>

    <div id="output"></div>

    <script>
    async function callCloudFunction() {
        const cloudFunctionUrl = url ; // 'https://us-east4-weatherapi2-414222.cloudfunctions.net/WebGetAvApi';

        try {
            const locationInput = document.getElementById('locationInput');
            const enteredLocations = locationInput.value.split(',').map(location => location.trim());

            // Ensure each location is wrapped in double quotes
            const quotedLocations = enteredLocations.map(location => `"${location}"`);

            const requestBody = {
                arrival_locations: quotedLocations
            };

            console.log('Generated JSON File:', JSON.stringify(requestBody, null, 2)); // Display the contents of the generated JSON file

            const response = await fetch(cloudFunctionUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            const responseData = await response.json();

            console.log('Response Data:', responseData); // Log the response data

            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = ''; // Clear previous output

            for (const key in responseData) {
                if (responseData.hasOwnProperty(key)) {
                    const entry = responseData[key];

                    // Create elements for each data point
                    const airportHeading = document.createElement('h3');
                    const metarElement = document.createElement('p');
                    const tafElement = document.createElement('p');

                    // Set text content
                    airportHeading.textContent = entry.icaoId;
                    metarElement.textContent = "METAR: " + entry.rawOb;
                    tafElement.textContent = "TAF: " + entry.rawTaf;

                    // Append elements to the output div
                    outputDiv.appendChild(airportHeading);
                    outputDiv.appendChild(metarElement);
                    outputDiv.appendChild(tafElement);
                }
            }
        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('output').innerText = 'Error fetching data';
        }
    }
</script>

</body>
</html>
